{"version":3,"file":"index.js","sources":["src/index.js"],"sourcesContent":["import karas from 'karas';\nimport { version } from '../package.json';\n\nclass FrameAnimate extends karas.Component {\n  componentDidMount() {\n    let { list = [], duration = 1000, playbackRate = 1, autoPlay = true } = this.props;\n    this.__playbackRate = playbackRate;\n    this.__isPlay = autoPlay;\n    if(list.length) {\n      let count = 0, total = 0, len = 0, sr = this.shadowRoot;\n      list.forEach(item => {\n        let { row = 1, column = 1, number = row * column } = item;\n        item.row = row;\n        item.column = column;\n        item.number = number;\n        total += number;\n        len++;\n      });\n      let per = duration / total;\n      list.forEach(item => {\n        item.begin = count;\n        item.end = count += per * item.number;\n      });\n      this.__count = 0;\n      sr.frameAnimate(diff => {\n        if(!this.__isPlay) {\n          return;\n        }\n        this.__count += diff * this.playbackRate;\n        if(this.__count >= duration) {\n          this.__count -= duration;\n        }\n        for(let i = 0; i < len; i++) {\n          let item = list[i];\n          if(this.__count >= item.begin && this.__count < item.end) {\n            let percent = (this.__count - item.begin) / (item.end - item.begin);\n            let per = 1 / item.number;\n            let n = Math.floor(percent / per);\n            if(n > item.number) {\n              n = item.number - 1;\n            }\n            let x = n % item.column;\n            let y = Math.floor(n / item.column);\n            sr.updateStyle({\n              backgroundImage: `url(${item.url})`,\n              backgroundSize: `${item.column * 100}% ${item.row * 100}%`,\n              backgroundPositionX: x * 100 / (item.column - 1) + '%',\n              backgroundPositionY: y * 100 / (item.row - 1) + '%',\n            }, () => {\n              this.emit('frame');\n            });\n            break;\n          }\n        }\n      });\n    }\n  }\n\n  render() {\n    return <div/>;\n  }\n\n  play() {\n    this.__isPlay = true;\n    this.__count = 0;\n  }\n\n  pause() {\n    this.__isPlay = false;\n  }\n\n  resume() {\n    this.__isPlay = true;\n  }\n\n  get playbackRate() {\n    return this.__playbackRate || this.props.playbackRate || 1;\n  }\n\n  set playbackRate(v) {\n    this.__playbackRate = parseFloat(v) || 1;\n  }\n}\n\nFrameAnimate.version = version;\n\nexport default FrameAnimate;\n"],"names":["FrameAnimate","props","list","duration","playbackRate","autoPlay","__playbackRate","__isPlay","length","count","total","len","sr","shadowRoot","forEach","item","row","column","number","per","begin","end","__count","frameAnimate","diff","i","percent","n","Math","floor","x","y","updateStyle","backgroundImage","url","backgroundSize","backgroundPositionX","backgroundPositionY","emit","karas","v","parseFloat","Component","version"],"mappings":"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"}