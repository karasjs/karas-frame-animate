{"version":3,"file":"index.es.js","sources":["src/index.js"],"sourcesContent":["import karas from 'karas';\nimport { version } from '../package.json';\n\nclass FrameAnimate extends karas.Component {\n  componentDidMount() {\n    let { list = [], duration = 1000, direction, playbackRate = 1, autoPlay = true } = this.props;\n    this.__playbackRate = playbackRate;\n    this.__isPlay = autoPlay;\n    if(list.length) {\n      let count = 0, total = 0, sr = this.shadowRoot;\n      list.forEach(item => {\n        let { row = 1, column = 1, number = row * column } = item;\n        item.row = row;\n        item.column = column;\n        item.number = number;\n        total += number;\n      });\n      // 计算每个所占时长\n      let per = duration / total;\n      list.forEach(item => {\n        item.begin = count;\n        item.end = count += per * item.number;\n      });\n      // 反向也需要\n      count = 0;\n      list.reverse().forEach(item => {\n        item.begin2 = count;\n        item.end2 = count += per * item.number;\n      });\n      // 帧动画部分\n      let alternate = 1, first = true;\n      this.__count = 0;\n      sr.frameAnimate(diff => {\n        if(!this.__isPlay && !first) {\n          return;\n        }\n        first = false;\n        this.__count += diff * this.playbackRate;\n        while(this.__count >= duration) {\n          this.__count -= duration;\n          if(direction === 'alternate') {\n            alternate *= -1;\n          }\n        }\n        if(alternate === -1) {\n          for(let i = 0; i < list.length; i++) {\n            let item = list[i];\n            if(this.__count >= item.begin2 && this.__count < item.end2) {\n              let percent = (this.__count - item.begin2) / (item.end2 - item.begin2);\n              let per = 1 / item.number;\n              let n = Math.floor(percent / per);\n              if(n > item.number) {\n                n = item.number - 1;\n              }\n              let x = n % item.column;\n              let y = Math.floor(n / item.column);\n              x = item.column - x - 1;\n              sr.updateStyle({\n                backgroundImage: `url(${item.url})`,\n                backgroundSize: `${item.column * 100}% ${item.row * 100}%`,\n                backgroundPositionX: x * 100 / (item.column - 1) + '%',\n                backgroundPositionY: y * 100 / (item.row - 1) + '%',\n              }, () => {\n                this.emit('frame');\n              });\n              break;\n            }\n          }\n        }\n        else {\n          for(let i = 0; i < list.length; i++) {\n            let item = list[i];\n            if(this.__count >= item.begin && this.__count < item.end) {\n              let percent = (this.__count - item.begin) / (item.end - item.begin);\n              let per = 1 / item.number;\n              let n = Math.floor(percent / per);\n              if(n > item.number) {\n                n = item.number - 1;\n              }\n              let x = n % item.column;\n              let y = Math.floor(n / item.column);\n              sr.updateStyle({\n                backgroundImage: `url(${item.url})`,\n                backgroundSize: `${item.column * 100}% ${item.row * 100}%`,\n                backgroundPositionX: x * 100 / (item.column - 1) + '%',\n                backgroundPositionY: y * 100 / (item.row - 1) + '%',\n              }, () => {\n                this.emit('frame');\n              });\n              break;\n            }\n          }\n        }\n      });\n    }\n  }\n\n  render() {\n    return <div/>;\n  }\n\n  play() {\n    this.__isPlay = true;\n    this.__count = 0;\n  }\n\n  pause() {\n    this.__isPlay = false;\n  }\n\n  resume() {\n    this.__isPlay = true;\n  }\n\n  get playbackRate() {\n    return this.__playbackRate || this.props.playbackRate || 1;\n  }\n\n  set playbackRate(v) {\n    this.__playbackRate = parseFloat(v) || 1;\n  }\n}\n\nFrameAnimate.version = version;\n\nexport default FrameAnimate;\n"],"names":["FrameAnimate","props","list","duration","direction","playbackRate","autoPlay","__playbackRate","__isPlay","length","count","total","sr","shadowRoot","forEach","item","row","column","number","per","begin","end","reverse","begin2","end2","alternate","first","__count","frameAnimate","diff","i","percent","n","Math","floor","x","y","updateStyle","backgroundImage","url","backgroundSize","backgroundPositionX","backgroundPositionY","emit","v","parseFloat","karas","Component","version"],"mappings":"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"}