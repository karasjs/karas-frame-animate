{"version":3,"file":"index.es.js","sources":["src/index.js"],"sourcesContent":["import karas from 'karas';\nimport { version } from '../package.json';\n\nconst {\n  refresh: {\n    level: {\n      CACHE,\n    },\n    webgl: {\n      drawTextureCache,\n    },\n  },\n  math: {\n    matrix: {\n      calRectPoint,\n    },\n  },\n  util: {\n    isNil,\n  },\n  mode: {\n    CANVAS,\n    WEBGL,\n  },\n  inject,\n} = karas;\n\nfunction convertCoords2Gl(x, y, z, w, cx, cy, tz) {\n  if(w && w !== 1) {\n    x /= w;\n    y /= w;\n    z /= w;\n  }\n  if(x === cx) {\n    x = 0;\n  }\n  else {\n    x = (x - cx) / cx;\n  }\n  if(y === cy) {\n    y = 0;\n  }\n  else {\n    y = (cy - y) / cy;\n  }\n  if(tz) {\n    z /= -tz;\n  }\n  if(w === 1) {\n    return { x, y, z, w };\n  }\n  return { x: x * w, y: y * w, z: z * w, w };\n}\n\nclass $ extends karas.Geom {\n  constructor(tagName, props) {\n    super(tagName, props);\n    this.fill = props.fill;\n    this.list = props.list;\n  }\n  render(renderMode, ctx, dx, dy) {\n    let res = super.render(renderMode, ctx, dx, dy);\n    if(res.break) {\n      return res;\n    }\n    let root = this.__root;\n    if(renderMode !== root.__renderMode) {\n      return res;\n    }\n    let index = this.index, tx = this.tx, ty = this.ty, fill = this.fill, list = this.list;\n    // 第一次需要查看fill，渲染第一帧\n    if(index === undefined) {\n      if(fill === 'both' || fill === 'backwards') {\n        for(let i = 0, len = list.length; i < len; i++) {\n          let item = list[i];\n          // 防止空的\n          if(item.number) {\n            index = i;\n            tx = 0;\n            ty = 0;\n            break;\n          }\n        }\n      }\n      else {\n        return;\n      }\n    }\n    this.lastIndex = index;\n    let item = list[index];\n    if(!item.loading) {\n      item.loading = true;\n      inject.measureImg(item.url, res => {\n        if(res.success) {\n          item.cache = res;\n          if(index === this.lastIndex && !this.isDestroyed) {\n            this.render(renderMode, ctx, dx, dy);\n          }\n        }\n      });\n    }\n    let cache = item.cache;\n    if(cache) {\n      this.lastTx = tx;\n      this.lastTy = ty;\n      let w = cache.width / item.column, h = cache.height / item.row;\n      let sx = tx * w, sy = ty * h;\n      if(renderMode === CANVAS) {\n        ctx.drawImage(item.cache.source, sx, sy, w, h, this.x, this.y, this.width, this.height);\n        this.host.emit('frame');\n      }\n      else if(renderMode === WEBGL) {\n        let gl = ctx;\n        let env = this.env;\n        let cx = env.width * 0.5, cy = env.height * 0.5;\n        let texture = item.texture;\n        if(!texture) {\n          texture = item.texture = gl.createTexture();\n          gl.activeTexture(gl['TEXTURE0']);\n          gl.bindTexture(gl.TEXTURE_2D, texture);\n          gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, 1);\n          gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, true);\n          gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, cache.source);\n          gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n          gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n          gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n          gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\n        }\n        else {\n          gl.activeTexture(gl['TEXTURE0']);\n          gl.bindTexture(gl.TEXTURE_2D, texture);\n        }\n        if(texture) {\n          gl.useProgram(gl.program);\n          let m = this.matrixEvent, opacity = this.opacity;\n          let { x1, y1, z1, w1, x2, y2, z2, w2, x3, y3, z3, w3, x4, y4, z4, w4 }\n            = calRectPoint(this.x + dx, this.y + this.height + dy,\n            this.x + this.width + dx, this.y + dy, m);\n          let z = Math.max(Math.abs(z1), Math.abs(z2));\n          z = Math.max(z, Math.abs(z3));\n          z = Math.max(z, Math.abs(z4));\n          if(z) {\n            z = Math.max(z, Math.sqrt(cx * cx + cy * cy));\n          }\n          let t = convertCoords2Gl(x1, y1, z1, w1, cx, cy, z);\n          x1 = t.x; y1 = t.y; z1 = t.z;\n          t = convertCoords2Gl(x2, y2, z2, w2, cx, cy, z);\n          x2 = t.x; y2 = t.y; z2 = t.z;\n          t = convertCoords2Gl(x3, y3, z3, w3, cx, cy, z);\n          x3 = t.x; y3 = t.y; z3 = t.z;\n          t = convertCoords2Gl(x4, y4, z4, w4, cx, cy, z);\n          x4 = t.x; y4 = t.y; z4 = t.z;\n          let vtPoint = new Float32Array([\n            x1, y1, z1, w1,\n            x4, y4, z4, w4,\n            x2, y2, z2, w2,\n            x4, y4, z4, w4,\n            x2, y2, z2, w2,\n            x3, y3, z3, w3,\n          ]);\n          let tx1 = sx / cache.width, ty1 = (cache.height - sy - h) / cache.height;\n          let tx2 = (sx + w) / cache.width, ty2 = (cache.height - sy) / cache.height;\n          let vtTex = new Float32Array([\n            tx1, ty1, tx1, ty2, tx2, ty1,\n            tx1, ty2, tx2, ty1, tx2, ty2,\n          ]);\n          let vtOpacity = new Float32Array([\n            opacity, opacity, opacity, opacity, opacity, opacity,\n          ]);\n          // 顶点buffer\n          let pointBuffer = gl.createBuffer();\n          gl.bindBuffer(gl.ARRAY_BUFFER, pointBuffer);\n          gl.bufferData(gl.ARRAY_BUFFER, vtPoint, gl.STATIC_DRAW);\n          let a_position = gl.getAttribLocation(gl.program, 'a_position');\n          gl.vertexAttribPointer(a_position, 4, gl.FLOAT, false, 0, 0);\n          gl.enableVertexAttribArray(a_position);\n          // 纹理buffer\n          let texBuffer = gl.createBuffer();\n          gl.bindBuffer(gl.ARRAY_BUFFER, texBuffer);\n          gl.bufferData(gl.ARRAY_BUFFER, vtTex, gl.STATIC_DRAW);\n          let a_texCoords = gl.getAttribLocation(gl.program, 'a_texCoords');\n          gl.vertexAttribPointer(a_texCoords, 2, gl.FLOAT, false, 0, 0);\n          gl.enableVertexAttribArray(a_texCoords);\n          // opacity buffer\n          let opacityBuffer = gl.createBuffer();\n          gl.bindBuffer(gl.ARRAY_BUFFER, opacityBuffer);\n          gl.bufferData(gl.ARRAY_BUFFER, vtOpacity, gl.STATIC_DRAW);\n          let a_opacity = gl.getAttribLocation(gl.program, 'a_opacity');\n          gl.vertexAttribPointer(a_opacity, 1, gl.FLOAT, false, 0, 0);\n          gl.enableVertexAttribArray(a_opacity);\n          // 纹理单元\n          let u_texture = gl.getUniformLocation(gl.program, 'u_texture');\n          gl.uniform1i(u_texture, 0);\n          gl.drawArrays(gl.TRIANGLES, 0, 6);\n          gl.deleteBuffer(pointBuffer);\n          gl.deleteBuffer(texBuffer);\n          gl.deleteBuffer(opacityBuffer);\n          gl.disableVertexAttribArray(a_position);\n          gl.disableVertexAttribArray(a_texCoords);\n          gl.disableVertexAttribArray(a_opacity);\n          this.host.emit('frame');\n        }\n      }\n    }\n  }\n}\n\nclass FrameAnimate extends karas.Component {\n  constructor(props) {\n    super(props);\n    let {\n      duration = 1000,\n      direction,\n      delay = 0,\n      playbackRate = 1,\n      iterations = Infinity,\n      fill = 'both',\n    } = this.props;\n    this.duration = duration;\n    this.direction = direction;\n    this.playbackRate = playbackRate;\n    this.iterations = iterations;\n    this.delay = delay;\n    this.fill = fill;\n    this.__timeCount = 0;\n    let { list = [] } = this.props;\n    if(list.length) {\n      let count = 0, total = 0;\n      list.forEach((item, i) => {\n        let { row = 1, column = 1, number = row * column } = item;\n        item.row = row;\n        item.column = column;\n        item.number = number;\n        total += number;\n        item.index = i;\n      });\n      // 计算每个所占时长\n      let per = this.duration / total;\n      list.forEach(item => {\n        item.begin = count;\n        item.end = count += per * item.number;\n      });\n      // 反向也需要\n      count = 0;\n      list.reverse().forEach(item => {\n        item.begin2 = count;\n        item.end2 = count += per * item.number;\n      });\n      list.reverse();\n    }\n    this.list = list;\n  }\n\n  componentDidMount() {\n    let { list = [], autoPlay = true } = this.props;\n    if(list.length) {\n      let fake = this.ref.fake, root = this.root;\n      let cb = this.cb = diff => {\n        let currentTime = this.__timeCount += diff * this.playbackRate;\n        currentTime -= this.delay;\n        if(currentTime < 0) {\n          return;\n        }\n        let playCount = Math.floor(currentTime / this.duration);\n        if(playCount >= this.iterations) {\n          this.pause();\n          let fill = this.fill;\n          if(fill !== 'both' && fill !== 'forwards') {\n            fake.index = undefined;\n            root.__addUpdate(fake, [], CACHE, false, false, null, null);\n            return;\n          }\n        }\n        currentTime -= playCount * this.duration;\n        let alternate = false;\n        if(this.direction === 'alternate') {\n          alternate = playCount % 2 === 1;\n        }\n        if(alternate) {\n          for(let i = 0; i < list.length; i++) {\n            let item = list[i];\n            if(currentTime >= item.begin2 && currentTime < item.end2) {\n              let percent = (currentTime - item.begin2) / (item.end2 - item.begin2);\n              let per = 1 / item.number;\n              let n = Math.floor(percent / per);\n              if(n > item.number) {\n                n = item.number - 1;\n              }\n              let x = n % item.column;\n              let y = Math.floor(n / item.column);\n              x = item.column - x - 1;\n              y = item.row - y - 1;\n              fake.index = i;\n              fake.tx = x;\n              fake.ty = y;\n              root.__addUpdate(fake, [], CACHE, false, false, null, null);\n              break;\n            }\n          }\n        }\n        else {\n          for(let i = 0; i < list.length; i++) {\n            let item = list[i];\n            if(currentTime >= item.begin && currentTime < item.end) {\n              let percent = (currentTime - item.begin) / (item.end - item.begin);\n              let per = 1 / item.number;\n              let n = Math.floor(percent / per);\n              if(n > item.number) {\n                n = item.number - 1;\n              }\n              let x = n % item.column;\n              let y = Math.floor(n / item.column);\n              fake.index = i;\n              fake.tx = x;\n              fake.ty = y;\n              root.__addUpdate(fake, [], CACHE, false, false, null, null);\n              break;\n            }\n          }\n        }\n      };\n      if(autoPlay) {\n        fake.frameAnimate(cb);\n      }\n    }\n  }\n\n  componentWillUnmount() {\n    let { list = [] } = this.props;\n    let root = this.__root, renderMode = root.__renderMode;\n    if(renderMode === WEBGL) {\n      list.forEach(item => {\n        if(item.texture) {\n          root.ctx.deleteTexture(item.texture);\n        }\n      });\n    }\n  }\n\n  render() {\n    return <div>\n      <$ ref=\"fake\" style={{\n        width: '100%',\n        height: '100%',\n      }} fill={this.fill} list={this.list} direction={this.direction}\n         delay={this.delay} duration={this.duration} iterations={this.iterations}/>\n    </div>;\n  }\n\n  play() {\n    this.__timeCount = 0;\n    this.pause();\n    this.resume();\n  }\n\n  pause() {\n    this.ref.fake.removeFrameAnimate(this.cb);\n  }\n\n  pauseTo(n = 0) {\n    this.__timeCount = n;\n    this.cb(0);\n  }\n\n  pauseToFrame(n = 0) {\n    let { list = [] } = this.props;\n    for(let i = 0, len = list.length; i < len; i++) {\n      let item = list[i];\n      let { row = 1, column = 1, number = row * column } = item;\n      if(n < number) {\n        this.__timeCount = item.begin + (item.end - item.begin) * n;\n        let x = n % column;\n        let y = Math.floor(n / column);\n        let fake = this.ref.fake;\n        if(fake.index !== i || fake.lastTx !== x || fake.lastTy !== y) {\n          fake.index = fake.lastIndex = i;\n          fake.tx = x;\n          fake.ty = y;\n          this.root.__addUpdate(fake, [], CACHE, false, false, null, null);\n        }\n        break;\n      }\n    }\n  }\n\n  stop() {\n    this.pause();\n    this.__timeCount = 0;\n    let fake = this.ref.fake;\n    fake.index = undefined;\n    this.root.__addUpdate(fake, [], CACHE, false, false, null, null);\n  }\n\n  resume() {\n    this.ref.fake.frameAnimate(this.cb);\n  }\n\n  get duration() {\n    return this.__duration;\n  }\n\n  set duration(v) {\n    v = parseFloat(v) || 1000;\n    if(v <= 0) {\n      v = 1;\n    }\n    this.__duration = v;\n  }\n\n  get playbackRate() {\n    return this.__playbackRate;\n  }\n\n  set playbackRate(v) {\n    v = parseFloat(v) || 1;\n    if(v <= 0) {\n      v = 1;\n    }\n    this.__playbackRate = v;\n  }\n\n  get direction() {\n    return this.__direction;\n  }\n\n  set direction(v) {\n    this.__direction = v;\n  }\n\n  get iterations() {\n    return this.__iterations;\n  }\n\n  set iterations(v) {\n    if(v !== Infinity) {\n      v = parseInt(v) || 1;\n    }\n    if(v <= 0) {\n      v = 1;\n    }\n    this.__iterations = v;\n  }\n\n  get delay() {\n    return this.__delay;\n  }\n\n  set delay(v) {\n    this.__delay = parseInt(v) || 0;\n  }\n\n  get fill() {\n    return this.__fill;\n  }\n\n  set fill(v) {\n    this.__fill = v;\n  }\n\n  get list() {\n    return this.__list;\n  }\n\n  set list(v) {\n    this.__list = v;\n  }\n}\n\nFrameAnimate.version = version;\n\nexport default FrameAnimate;\n"],"names":["karas","refresh","CACHE","level","webgl","drawTextureCache","calRectPoint","math","matrix","util","isNil","mode","CANVAS","WEBGL","inject","convertCoords2Gl","x","y","z","w","cx","cy","tz","$","tagName","props","fill","list","renderMode","ctx","dx","dy","res","root","__root","__renderMode","index","tx","ty","undefined","i","len","length","item","number","lastIndex","loading","measureImg","url","success","cache","isDestroyed","render","lastTx","lastTy","width","column","h","height","row","sx","sy","drawImage","source","host","emit","gl","env","texture","createTexture","activeTexture","bindTexture","TEXTURE_2D","pixelStorei","UNPACK_FLIP_Y_WEBGL","UNPACK_PREMULTIPLY_ALPHA_WEBGL","texImage2D","RGBA","UNSIGNED_BYTE","texParameteri","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","TEXTURE_MIN_FILTER","LINEAR","TEXTURE_MAG_FILTER","useProgram","program","m","matrixEvent","opacity","x1","y1","z1","w1","x2","y2","z2","w2","x3","y3","z3","w3","x4","y4","z4","w4","Math","max","abs","sqrt","t","vtPoint","Float32Array","tx1","ty1","tx2","ty2","vtTex","vtOpacity","pointBuffer","createBuffer","bindBuffer","ARRAY_BUFFER","bufferData","STATIC_DRAW","a_position","getAttribLocation","vertexAttribPointer","FLOAT","enableVertexAttribArray","texBuffer","a_texCoords","opacityBuffer","a_opacity","u_texture","getUniformLocation","uniform1i","drawArrays","TRIANGLES","deleteBuffer","disableVertexAttribArray","Geom","FrameAnimate","duration","direction","delay","playbackRate","iterations","Infinity","__timeCount","count","total","forEach","per","begin","end","reverse","begin2","end2","autoPlay","fake","ref","cb","diff","currentTime","playCount","floor","pause","__addUpdate","alternate","percent","n","frameAnimate","deleteTexture","resume","removeFrameAnimate","__duration","v","parseFloat","__playbackRate","__direction","__iterations","parseInt","__delay","__fill","__list","Component","version"],"mappings":"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"}